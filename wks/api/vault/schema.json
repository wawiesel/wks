{
    "$schema": "https://json-schema.org/draft/2020-12/schema",
    "$id": "https://wks/specifications/vault_output.schema.json",
    "title": "WKS Vault Output Schemas",
    "type": "object",
    "definitions": {
        "Base": {
            "type": "object",
            "properties": {
                "errors": {
                    "type": "array",
                    "items": {
                        "type": "string"
                    }
                },
                "warnings": {
                    "type": "array",
                    "items": {
                        "type": "string"
                    }
                }
            },
            "required": [
                "errors",
                "warnings"
            ],
            "additionalProperties": true
        },
        "VaultIssue": {
            "type": "object",
            "properties": {
                "from_uri": {
                    "type": "string"
                },
                "line_number": {
                    "type": "integer"
                },
                "to_uri": {
                    "type": "string"
                },
                "status": {
                    "type": "string"
                }
            },
            "required": [
                "from_uri",
                "line_number",
                "to_uri",
                "status"
            ],
            "additionalProperties": false
        },
        "VaultEdge": {
            "type": "object",
            "properties": {
                "from_uri": {
                    "type": "string"
                },
                "to_uri": {
                    "type": "string"
                },
                "line_number": {
                    "type": "integer"
                }
            },
            "required": [
                "from_uri",
                "to_uri",
                "line_number"
            ],
            "additionalProperties": false
        },
        "VaultStatusOutput": {
            "allOf": [
                {
                    "$ref": "#/definitions/Base"
                },
                {
                    "type": "object",
                    "properties": {
                        "database": {
                            "type": "string"
                        },
                        "total_links": {
                            "type": "integer"
                        },
                        "last_sync": {
                            "type": [
                                "string",
                                "null"
                            ]
                        },
                        "success": {
                            "type": "boolean"
                        }
                    },
                    "required": [
                        "database",
                        "total_links",
                        "last_sync",
                        "success"
                    ],
                    "additionalProperties": false
                }
            ]
        },
        "VaultSyncOutput": {
            "allOf": [
                {
                    "$ref": "#/definitions/Base"
                },
                {
                    "type": "object",
                    "properties": {
                        "notes_scanned": {
                            "type": "integer"
                        },
                        "links_written": {
                            "type": "integer"
                        },
                        "links_deleted": {
                            "type": "integer"
                        },
                        "sync_duration_ms": {
                            "type": "integer"
                        },
                        "success": {
                            "type": "boolean"
                        }
                    },
                    "required": [
                        "notes_scanned",
                        "links_written",
                        "links_deleted",
                        "sync_duration_ms",
                        "success"
                    ],
                    "additionalProperties": false
                }
            ]
        },
        "VaultCheckOutput": {
            "allOf": [
                {
                    "$ref": "#/definitions/Base"
                },
                {
                    "type": "object",
                    "properties": {
                        "path": {
                            "type": [
                                "string",
                                "null"
                            ]
                        },
                        "notes_checked": {
                            "type": "integer"
                        },
                        "links_checked": {
                            "type": "integer"
                        },
                        "broken_count": {
                            "type": "integer"
                        },
                        "issues": {
                            "type": "array",
                            "items": {
                                "$ref": "#/definitions/VaultIssue"
                            }
                        },
                        "is_valid": {
                            "type": "boolean"
                        },
                        "success": {
                            "type": "boolean"
                        }
                    },
                    "required": [
                        "path",
                        "notes_checked",
                        "links_checked",
                        "broken_count",
                        "issues",
                        "is_valid",
                        "success"
                    ],
                    "additionalProperties": false
                }
            ]
        },
        "VaultLinksOutput": {
            "allOf": [
                {
                    "$ref": "#/definitions/Base"
                },
                {
                    "type": "object",
                    "properties": {
                        "path": {
                            "type": "string"
                        },
                        "direction": {
                            "type": "string",
                            "enum": [
                                "to",
                                "from",
                                "both"
                            ]
                        },
                        "edges": {
                            "type": "array",
                            "items": {
                                "$ref": "#/definitions/VaultEdge"
                            }
                        },
                        "count": {
                            "type": "integer"
                        },
                        "success": {
                            "type": "boolean"
                        }
                    },
                    "required": [
                        "path",
                        "direction",
                        "edges",
                        "count",
                        "success"
                    ],
                    "additionalProperties": false
                }
            ]
        },
        "VaultRepairEntry": {
            "type": "object",
            "properties": {
                "old_path": {
                    "type": "string"
                },
                "new_path": {
                    "type": "string"
                },
                "old_link": {
                    "type": "string"
                },
                "new_link": {
                    "type": "string"
                },
                "files_rewritten": {
                    "type": "integer"
                },
                "edges_updated": {
                    "type": "integer"
                }
            },
            "required": [
                "old_path",
                "new_path",
                "old_link",
                "new_link",
                "files_rewritten",
                "edges_updated"
            ],
            "additionalProperties": false
        },
        "VaultUnresolvedEntry": {
            "type": "object",
            "properties": {
                "symlink": {
                    "type": "string"
                },
                "old_path": {
                    "type": "string"
                },
                "reason": {
                    "type": "string"
                }
            },
            "required": [
                "symlink",
                "old_path",
                "reason"
            ],
            "additionalProperties": false
        },
        "VaultRepairOutput": {
            "allOf": [
                {
                    "$ref": "#/definitions/Base"
                },
                {
                    "type": "object",
                    "properties": {
                        "fixed": {
                            "type": "array",
                            "items": {
                                "$ref": "#/definitions/VaultRepairEntry"
                            }
                        },
                        "unresolved": {
                            "type": "array",
                            "items": {
                                "$ref": "#/definitions/VaultUnresolvedEntry"
                            }
                        },
                        "fixed_count": {
                            "type": "integer"
                        },
                        "unresolved_count": {
                            "type": "integer"
                        },
                        "success": {
                            "type": "boolean"
                        }
                    },
                    "required": [
                        "fixed",
                        "unresolved",
                        "fixed_count",
                        "unresolved_count",
                        "success"
                    ],
                    "additionalProperties": false
                }
            ]
        }
    },
    "oneOf": [
        {
            "$ref": "#/definitions/VaultStatusOutput"
        },
        {
            "$ref": "#/definitions/VaultSyncOutput"
        },
        {
            "$ref": "#/definitions/VaultCheckOutput"
        },
        {
            "$ref": "#/definitions/VaultLinksOutput"
        },
        {
            "$ref": "#/definitions/VaultRepairOutput"
        }
    ]
}
